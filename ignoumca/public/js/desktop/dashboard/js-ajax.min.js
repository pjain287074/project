'use strict';

const editProfile = (function(){
  return{
    init(){
      let profileEditBtn = document.getElementsByClassName('js-profile-edit')[0];
      editProfile.inputEventHandler();
      profileEditBtn.addEventListener('click',()=>{
        let actionDetail = profileEditBtn.dataset.action;
        let editBtn ;
        let formCover = document.getElementsByClassName('js-form-cover')[0];
        let actionLine = document.getElementsByClassName('js-toggle-line')[0];
        if(actionDetail == 'edit' ){
          editBtn = 'save';
          formCover.classList.add('hide');
          actionLine.classList.add('hide');

          profileEditBtn.setAttribute('data-action',editBtn);
          profileEditBtn.getElementsByTagName('p')[0].innerHTML = `${editBtn} profile`; 
        }else{

              
          let formElems = document.querySelectorAll('.js-validate');

          formElems.forEach(currElem=>{
            if (currElem.parentNode.getElementsByClassName('danger-info').length > 0){
              currElem.parentNode.getElementsByClassName('danger-info')[0].remove();
            }
            editProfile.validateAction(currElem);
          });          
          if(document.getElementsByClassName('danger-info').length == 0){
            editProfile.ajaxAction();
            editBtn = 'edit';
            formCover.classList.remove('hide');
            actionLine.classList.remove('hide');

            profileEditBtn.setAttribute('data-action',editBtn);
            profileEditBtn.getElementsByTagName('p')[0].innerHTML = `${editBtn} profile`; 
          }
           
        

        }
      });
    },
    inputEventHandler(){
      
      let formElems = document.querySelectorAll('.js-validate');
      
      formElems.forEach(currElem=>{
        currElem.addEventListener('input',()=>{
          if (currElem.parentNode.getElementsByClassName('danger-info').length > 0){
            currElem.parentNode.getElementsByClassName('danger-info')[0].remove();
          }
          editProfile.validateAction(currElem);
        })  
        
      });
    }
    ,
    validateAction(elem){
      
      let format = /^[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/;
      if( !(/^[a-zA-Z0-9- ]*$/.test(elem.value)) ){
        elem.insertAdjacentHTML('afterend','<p class="color-red mt-1 mb-0 f-10 t-l danger-info">No Special Characters Are Allowed</p>');
        return false;
      }
  
      switch(elem.dataset.validate){
        case 'text': 

          if( elem.value.trim() == ''  || elem.value.length == 0){
            elem.insertAdjacentHTML('afterend','<p class="color-red mt-1 mb-0 f-10 t-l danger-info">Enter Data</p>');
            return false;
          }
          return true;
        break;
        case 'mobile':
          if(elem.value.length < 7 || elem.value.length > 16){
            
            elem.insertAdjacentHTML('afterend','<p class="color-red mt-1 mb-0 f-10 t-l danger-info ">Enter Valid Mobile No</p>');
            return false; 
          }
          return true;
        break;
        case 'alphanumeric':
          
          if( elem.value.trim() == ''  || elem.value.length == 0){
            elem.insertAdjacentHTML('afterend','<p class="color-red mt-1 mb-0 f-10 t-l danger-info">Enter Data</p>');
            return false;
          }
          return true;
        break;
        case 'select':

          if( elem.value.trim() == ''  || elem.value.length == 0){
            
            elem.insertAdjacentHTML('afterend','<p class="color-red mt-1 mb-0 f-10 t-l danger-info">Enter Data</p>');
            return false;
          }
          return true;
        break;
      }
    },
    ajaxAction(){
      
      let data = $('#userform').serializeArray();
      $.ajax({
          url: "https://learningsandeep.000webhostapp.com/CodeIgniter-3.1.101/dashboard/edit",
          data: data,
          method: 'post',
          success: function(result){
            console.log(result);
          }
        });
    }

    

  }
})();

$('document').ready(function(){
  editProfile.init();

})


// "use strict";const editProfile={init(){let e=document.getElementsByClassName("js-profile-edit")[0];editProfile.inputEventHandler(),e.addEventListener("click",()=>{let t,a=e.dataset.action,n=document.getElementsByClassName("js-form-cover")[0],l=document.getElementsByClassName("js-toggle-line")[0];"edit"==a?(t="save",n.classList.add("hide"),l.classList.add("hide")):(t="edit",n.classList.remove("hide"),l.classList.remove("hide")),e.setAttribute("data-action",t),e.getElementsByTagName("p")[0].innerHTML=`${t} profile`})},inputEventHandler(){document.querySelectorAll(".js-validate").forEach(e=>{e.addEventListener("input",()=>{e.parentNode.getElementsByClassName("danger-info").length>0&&e.parentNode.getElementsByClassName("danger-info")[0].remove(),editProfile.validateAction(e)})})},validateAction(e){if(!/^[a-zA-Z0-9- ]*$/.test(e.value))return e.insertAdjacentHTML("afterend",'<p class="color-red mt-1 mb-0 f-10 t-l danger-info">No Special Characters Are Allowed</p>'),!1;switch(e.dataset.validate){case"text":return""!=e.value.trim()&&0!=e.value.length||(e.insertAdjacentHTML("afterend",'<p class="color-red mt-1 mb-0 f-10 t-l danger-info">Enter Data</p>'),!1);case"mobile":return!(e.value.length<7||e.value.length>16)||(e.insertAdjacentHTML("afterend",'<p class="color-red mt-1 mb-0 f-10 t-l danger-info ">Enter Valid Mobile No</p>'),!1);case"alphanumeric":case"select":return""!=e.value.trim()&&0!=e.value.length||(e.insertAdjacentHTML("afterend",'<p class="color-red mt-1 mb-0 f-10 t-l danger-info">Enter Data</p>'),!1)}},ajaxAction(){}};$("document").ready(function(){editProfile.init()});